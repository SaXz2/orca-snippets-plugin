# Orca 代码片段管理器

一个为虎鲸笔记（Orca Note）开发的 CSS 和 JavaScript 代码片段管理插件，让你轻松管理和注入自定义代码。

## ✨ 功能特性

- 📝 创建、编辑、删除 CSS 和 JavaScript 代码片段
- 🔄 动态启用/禁用代码片段
- 💉 代码片段自动注入到页面
- 🎨 基于 CodeMirror 6 的代码编辑器，支持语法高亮
- 🔍 代码片段搜索功能
- 📦 导入/导出代码片段（JSON 格式）
- 🌐 支持国际化（中文/英文）
- 🎯 智能 DOM 就绪检测（JavaScript 代码片段）

## 📦 安装

1. 下载插件文件
2. 将插件文件夹复制到 Orca 插件目录：`orca/plugins/orca-snippets-plugin/`
3. 重启 Orca 或重新加载插件

## 🚀 使用方法

### 打开管理器

- 点击顶栏的代码图标按钮
- 或使用命令：`orca-snippets-plugin.openManager`

### 管理代码片段

1. 点击 `+` 按钮添加新代码片段
2. 选择代码类型（CSS 或 JavaScript）
3. 输入代码片段名称和内容
4. 使用开关启用/禁用代码片段
5. 点击编辑按钮修改现有代码片段
6. 点击删除按钮移除代码片段

### 导入/导出

- 点击更多菜单（三点图标）
- 选择"Export Snippets"导出所有代码片段为 JSON 文件
- 选择"Import Snippets"从 JSON 文件导入代码片段

## 🛠️ 开发

```bash
# 安装依赖
npm install

# 开发模式
npm run dev

# 构建
npm run build
```

构建后的文件会输出到 `dist/` 目录。

## ⚠️ 注意事项

### 安全性
JavaScript 代码会直接在页面中执行，请确保代码来源可信。不要执行未经验证的代码。

### 命名规范
代码片段之间可能存在变量/函数名冲突，建议：
- 使用 IIFE（立即执行函数）包裹代码
- 使用唯一的命名空间
- 避免污染全局作用域

### CSS 清理
禁用 CSS 代码片段时会自动移除注入的样式。

### JavaScript 清理
JavaScript 代码片段执行后无法自动清理其副作用（如事件监听器、定时器、全局变量等）。如需清理，请在代码中自行实现清理逻辑。

### DOM 就绪检测
插件会智能检测 JavaScript 代码是否包含 DOM 操作，并在适当的时机执行：
- 包含 DOM 操作的代码会等待 DOM 就绪后执行
- 不包含 DOM 操作的代码会立即执行

### 数据存储
代码片段存储在 Orca 插件数据库中。如果片段总大小超过 1MB，建议定期清理不需要的代码片段。

### 插件卸载
禁用插件时会自动清理所有注入的代码片段。

## 📄 许可证

MIT
